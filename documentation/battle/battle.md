# Боёвка

## Боевой персонаж

Характеристики:
- Здоровье (hp)
- Атака (atk)
- Защита (def)
- Сила (strength)
- Ловкость (agility)
- Мудрость (wisdom)

## Бой

Боёвка построена на принципе КНБ: сила > ловкость > мудрость > сила
В качестве основного инструмента баланса используются разновидности функций 1/x
- Она стремится к определённому значению, но никогда его не достигает, причём чем больше x, тем медленней растёт функция
- Если нужно определённое значение, к которому стремится функция, достаточно просто сместить по оси Y: 1/x + N
- Если функция растёт слишком быстро, достаточно просто умножить её на некий модификатор: (N * 1)/x
- Просто менять начальное значение путём смещения по оси X: 1/(x + N)

### Преимущество (advantage)
Преимущество Игрок1 перед Игрок2 на основе характеристик
```
сила1 = max(Игрок1.сила - Игрок2.ловкость / 2 - Игрок2.мудрость, 1)
ловкость1 = max(Игрок1.ловкость - Игрок2.мудрость / 2 - Игрок2.сила, 1)
мудрость1 = max(Игрок1.мудрость - Игрок2.сила / 2 - Игрок2.ловкость, 1)
сила2 = max(Игрок2.сила - Игрок1.ловкость / 2 - Игрок1.мудрость, 1)
ловкость2 = max(Игрок2.ловкость - Игрок1.мудрость / 2 - Игрок1.сила, 1)
мудрость2 = max(Игрок2.мудрость - Игрок1.сила / 2 - Игрок1.ловкость, 1)
преимущество = (сила1 + ловкость1 + мудрость1) - (сила2 + ловкость2 + мудрость2)
```
После необходимо посчитать итоговое значение от преимущества.
Максимум при значениях 13/1/1 и 1/13/1 = 1.2
```
fun число бонус_преимущества(перимущество) {
    если (перимущество) <= 0 {
        вернуть 1
    }
    вернуть 1 + (-4.125 / (перимущество + 8.25) + 0.5)
}
```

### Уворот
В бою есть шанс увернуться от атаки противника с базовой вероятностью 5%
Ниже реализация функции уворота (шанс от 5% до 17.9% при разнице 12)
```
fun bool уворот(ловкость1, ловкость2) {
    разница = ловкость1 - ловкость2
    шанс = 5
    смещение_х = -34.15
    если разница > смещение_х:
        шанс = шанс + max(-1707.69 / (разница - offset_x) + 50, 0)
    вернуть рандом(1, 100) <= шанс
} 
```

### Критический урон
В бою есть шанс нанести критический урон с базовой вероятностью 5%
Ниже реализации функции крита (шанс от 5 до 21.9 при разнице 12)
Модификатор крита равен 2
```
fun число крит(мудрость1, мудрость2) {
    разница = мудрость1 - мудрость2
    шанс = 5
    смещение_шанса_х = -23.29
    если diff > смещение_шанса_х:
        шанс = шанс + max(-1164.7 / (разница - смещение_шанса_х) + 50, 0)
    если рандом(1, 100) > шанс:
        вернуть 1
    вернуть 2
}
```

### Бонус атаки
Атака персонажа не является постоянной величиной, а колеблется от -10 до +10%
Сила персонажа способна увеличить бонус атаки от 0% до 17,(7)% при разнице силы 12.
Ниже реализация
```
fun число бонус_атаки(сила1, сила2) {
    отклонение = 0.1
    бонус = 0
    смещение_х = -15
    разница = сила1 - сила2
    if разница > смещение_х:
        бонус = бонус + max(-6 / (разница - смещение_х) + 0.4, 0)
    вернуть рандом(1 - отклонение, 1 + отклонение) + бонус
}
```

### Один ход боя (Игрок1 против Игрок2)

```
если не уворот(Игрок2.ловкость, Игрок1.ловкость):
    преимущество = Игрок1.преимущество(Игрок2)
        
    атака = Игрок1.атака
     * бонус_преимущества(преимущество) 
     * крит(Игрок1.мудрость, Игрок2.мудрость)
     * бонус_атаки(Игрок1.сила, Игрок2.сила)
    Игрок2.здоровье -= max(атака - Игрок2.защита, Игрок1.атака * мин_атака)
    
    если Игрок2.здоровье < 0:
        вернуть Игрок2.поражение
```




